- name: Clone latest version from github
  git:
    repo: 'https://github.com/adavisson/website.git'
    dest: /var/www/html/website/
    force: yes
  notify: Restart Apache
  become: true

- name: Clone latest version of Crazy Tales
  git:
    repo: 'https://github.com/adavisson/crazy-tales.git'
    dest: /var/www/html/crazy-tales/
    force: yes
  notify: Restart Apache
  become: true

- name: Clone latest version of CFB-Machine
  git:
    repo: 'https://github.com/adavisson/cfb-machine.git'
    dest: /var/www/html/cfb-machine/
    force: yes
  notify: Restart Apache
  become: true

# - name: Find all files to delete for cleanup
  # find:
    # path: "{{ item }}"
    # recurse: yes
    # excludes: 'build'
  # register: files_for_deletion
  # with_items:
    # - /var/www/html/website
    # - /var/www/html/crazy-tales
    # - /var/www/html/cfb-machine
  # become: true
  # 
# - debug:
    # msg: "{{ files_for_deletion.files }}"

# - name: Cleanup files
#   file:
#     path: "{{ item.path }}"
#     state: absent
#   with_items: "{{ files_for_deletion.files }}"
#   become: true

- name: Copy .htaccess file for client side routing
  copy:
    src: ../files/.htaccess
    dest: "{{ item }}"
  with_items:
    - "/var/www/html/website/build/"
    - "/var/www/html/crazy-tales/build/"
    - "/var/www/html/cfb-machine/build/"
  notify: Restart Apache
  become: true